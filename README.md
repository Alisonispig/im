##  ä¿¡ä½¿  ç®€æ´çš„IM

### ğŸ˜¯æ¼”ç¤ºåœ°å€

æ–‡æ¡£åœ°å€: [https://www.o0o0oo.com/](https://www.o0o0oo.com/)

æ¼”ç¤ºåœ°å€: [https://chat.o0o0oo.com/](https://chat.o0o0oo.com/)

å‰ç«¯åœ°å€ï¼š[https://gitee.com/LiLongLong719/im-web](https://gitee.com/LiLongLong719/im-web)

æ¼”ç¤ºè´¦å· a/a ä»…æ¼”ç¤ºç›®çš„.æœåŠ¡å™¨çš„å†…å®¹ä¸å®šæœŸæ¸…ç†

### å±•ç¤ºæˆªå›¾

![åŠŸèƒ½å±•ç¤º](doc/20220418005013.jpg)

### ğŸ¤©æ ¸å¿ƒç›®æ ‡: å®Œæˆå•æœº10W+çš„å¯ç”¨é¡¹ç›®

æ³¨æ„: æ—©æœŸçš„æ€è·¯å’Œå†…å®¹æ¥è‡ªJ-IM,æœ‰äººä¼šé—®ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨J-IM,
1. å…¶ä¸€åœ¨äºJ-IMå¤§éƒ¨åˆ†æ›´åŠ åå‘åº•å±‚,è€Œä¸”å¯¹äºæˆ‘æ¥è®²,ä¸»è¦ç›®çš„åœ¨äºå­¦ä¹ Tioå’Œé¡¹ç›®æ€è·¯,æˆ–è®¸è¿™æ ·æ›´æœ‰æˆå°±æ„Ÿ.
2. å…¶äºŒ ä»å¤´å¼€å§‹çš„ä»£ç æ›´æœ‰æŒæ§åŠ›,æ— è®ºä»£ç å¥½ä¸å,å¹¶ä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œç´¯ç§¯çš„ç»éªŒæ›´æœ‰ä»·å€¼.
3. å…¶ä¸‰é•¿æœŸç›®æ ‡æ˜¯å®ç°å¸¦UIçš„ç•Œé¢.æ¶ˆæ¯ä½“å’Œè®¾è®¡æ€è·¯ä¸ç›¸åŒä¼šå¯¹å‰ç«¯å®ç°æœ‰è¾ƒå¤§å½±å“

### ğŸ¤¦â€â™€ï¸æŠ€æœ¯æ ˆ

æ ¸å¿ƒTio,åŒ…æ‹¬httpå’Œsocketéƒ½æ˜¯tio.æ²¡æœ‰å¼•å…¥springç³»åˆ—ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†çš„å†…å®¹éƒ½éœ€è¦è‡ªå·±å°è£…ï¼Œå¥½å¤„æ˜¯å¯åŠ¨å¿«ï¼Œä½“ç§¯å°ã€‚å¼Šç«¯å°±æ˜¯æ–¹æ–¹é¢é¢éƒ½éœ€è¦è‡ªå·±è€ƒè™‘ã€‚ä»ç™»å½•å¼€å§‹æ‰€æœ‰çš„äº¤äº’å…¨éƒ¨ä½¿ç”¨socketï¼Œé™¤minioåˆ†ç‰‡ä¸Šä¼ ä½¿ç”¨äº†httpå¤–ï¼Œç›®å‰æ²¡æœ‰å…¶ä»–ä½¿ç”¨httpçš„åœ°æ–¹ã€‚ æ–‡ä»¶å­˜å‚¨ä½¿ç”¨äº†minio, ç¼“å­˜ä½¿ç”¨mangodb, åŒæ—¶è§£å†³ç¼“å­˜å’Œæ•°æ®å­˜å‚¨çš„é—®é¢˜ï¼ˆæ®è¯´æŒºå¿«çš„ï¼Œæ²¡æœ‰åšå¤§é‡å°è¯•ï¼‰

### ä½¿ç”¨

è¿è¡ŒImServerä¸‹Mainæ–¹æ³•

### æ‰“åŒ…

è¿è¡Œ mvn clean package
æ‹·è´Targetä¸‹ Im-Serverç›®å½•
Windowsä¸‹æ‰§è¡Œstartup.batæ–¹æ³•,Linuxæ‰§è¡Œstartup.sh
 
### ğŸ¤£è“å›¾  
[åœ¨çº¿æ–‡æ¡£](https://www.yuque.com/docs/share/8d1a4d1d-954d-478c-b23d-511d4558eed9)

### ğŸ‰å‰ç«¯UI
ç›®å‰æœ‰ä¸€äº›åˆç•¥çš„æƒ³æ³•,åŸºäºelectronå’Œwebå®ç°,å·²æœ‰ä¸€äº›é›å½¢,ä½†çŸ­æœŸç›®æ ‡è¿˜æ˜¯é›†ä¸­åœ¨å®ç°åŠŸèƒ½ä¸Šé¢

### å®‰è£…æ•™ç¨‹
> æ•™ç¨‹æ¥è‡ªwindows dockerï¼Œ linuxåŒç†
1. å®‰è£…minio
```
docker run -d -p 9000:9000 -p 9001:9001 --name minio -v /home/minio/data:/data -v /home/minio/cert:/root/.minio -e "MINIO_ROOT_USER=AKIAIOSFODNN7EXAMPLE" -e "MINIO_ROOT_PASSWORD=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY" --restart=always quay.io/minio/minio server /data --console-address ":9001"
```

2. å®‰è£…MongoDB
```
docker run --name mongo --restart=always -p 27017:27017 -v /home/mongodb:/data/db -e MONGO_INITDB_ROOT_USERNAME=admin -e MONGO_INITDB_ROOT_PASSWORD=å¯†ç   -d mongo:latest mongod --auth
```

3. å®‰è£…nginxï¼Œ ä½œè€…ä½¿ç”¨nginxWebui
```
# Linux
docker run -itd -v /home/nginxWebUI:/home/nginxWebUI -e BOOT_OPTIONS="--server.port=8080" --privileged=true --restart=always --net=host cym1102/nginxwebui:latest

# Windows
docker run -itd -p 8080:8080 -p 8888:8888 -v E:/docker/nginxWebUI:/home/nginxWebUI -e BOOT_OPTIONS="--server.port=8080" --privileged=true  cym1102/nginxwebui:latest
```

4. é…ç½®minio httpsè®¿é—®ï¼ˆæ­¤å¤„ä»¥è‡ªç­¾åä¸ºä¾‹ï¼‰ä¸‹è½½ç­¾åå·¥å…· [ç­¾åå·¥å…·](https://github.com/minio/certgen) 
> ä½¿ç”¨å…¬ç½‘è¯ä¹¦å¯å¿½ç•¥ç”Ÿæˆçš„æ­¥éª¤ï¼Œç›´æ¥è®²è¯ä¹¦æ”¾è¿›å»å³å¯
```
# 172.17.0.3 æ˜¯docker minioå†…éƒ¨IPï¼Œ éœ€è¦ç‰¹åˆ«æ³¨æ„è¿™ä¸ªIPåœ¨æ˜ å°„å‡ºç«¯å£çš„æƒ…å†µä¸‹å¿…é¡»å†™
certgen-windows-amd64.exe -ecdsa-curve P256 -host 127.0.0.1,localhost,172.17.0.3,192.168.0.103
```
æ”¾ç½®äºæŠ›å‡ºçš„ E:/docker/minio/cert ç›®å½•ä¸‹ï¼Œå®Œæ•´ç›®å½•ä¸º E:/docker/minio/cert/certs é‡å¯å®¹å™¨

5. é…ç½®JDKè¯ä¹¦ä¿¡ä»»ï¼Œå¦åˆ™ä¼šæŠ›å‡ºä¸‹åˆ—é”™è¯¯
```
javax.net.ssl.SSLHandshakeException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
	at java.base/sun.security.ssl.Alert.createSSLException(Alert.java:131)
	at java.base/sun.security.ssl.TransportContext.fatal(TransportContext.java:371)
	at java.base/sun.security.ssl.TransportContext.fatal(TransportContext.java:314)
```
åœ¨JDK binç›®å½•ä¸‹è¿è¡Œ
```
.\keytool -import -alias sslServer_03 -file D:\key\æ–°å»ºæ–‡ä»¶å¤¹\public.crt -keystore ..\lib\security\cacerts -storepass changeit -v
```
6. é…ç½®nginx
```
# å‚è€ƒé…ç½®å¦‚ä¸‹
http {
  include mime.types;
  default_type application/octet-stream;
  keepalive_timeout 75s;
  gzip on;
  gzip_min_length 4k;
  gzip_comp_level 4;
  client_max_body_size 1024m;
  client_header_buffer_size 32k;
  client_body_buffer_size 8m;
  server_names_hash_bucket_size 512;
  proxy_headers_hash_max_size 51200;
  proxy_headers_hash_bucket_size 6400;
  gzip_types application/javascript application/x-javascript text/javascript text/css application/json application/xml;
  error_log /home/nginxWebUI/log/error.log;
  map $http_upgrade $connection_upgrade {
    default upgrade;
    '' close;
  }
  access_log /home/nginxWebUI/log/access.log;
  server {
    listen 8888 ssl http2;
    ssl_certificate /home/nginxWebUI/cert/public.crt;
    ssl_certificate_key /home/nginxWebUI/cert/private.key;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
    location / {
      proxy_pass http://192.168.0.103:8081;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Host $http_host;
      proxy_set_header X-Forwarded-Port $server_port;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
    location /ws {
      proxy_pass http://192.168.0.103:9326;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Host $http_host;
      proxy_set_header X-Forwarded-Port $server_port;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
    location /api/ {
      proxy_pass http://192.168.0.103:8088/;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Host $http_host;
      proxy_set_header X-Forwarded-Port $server_port;
      proxy_set_header X-Forwarded-Proto $scheme;
    }
    location /courier/ {
      proxy_pass https://192.168.0.103:9000/courier/;
      proxy_connect_timeout 300;
      proxy_http_version 1.1;
      proxy_set_header Connection "";
      chunked_transfer_encoding off;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_set_header Host $http_host;
    }
  }
}

```

### ç‰¹åˆ«é¸£è°¢
J-IM

### äº¤æµ

![æ·»åŠ å¾®ä¿¡ï¼Œå¤‡æ³¨ä¿¡ä½¿](doc/2022å¹´4æœˆ18æ—¥.jpg)
